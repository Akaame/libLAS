
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>libLAS RFC 2: SpatialReference Overhaul &#8212; liblas.org</title>
    <link rel="stylesheet" href="../../_static/sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="next" title="Georeferencing LAS files with LAS 1.4" href="../wkt.html" />
    <link rel="prev" title="libLAS RFC 1: Vertical Coordinate Systems" href="rfc_1_verticalcs.html" />

 

  </head><body>

<table width="100%" style="width: 100%; background-color: white;">
  <tr>
    <td rowspan="2" style="padding: 10px 0px 10px 10px;">
      <a href="../../index.html" title="Home"><img src="../../_static/liblaslogo.png" alt="libLAS banner" border="0" /></a>
    </td>
    <td style="padding: 10px 10px 0px 0px; text-align: right; vertical-align: top;">
      <a href="../../index.html" title="Home">Home</a> |
      <a href="../../docs.html" title="Docs">Docs</a> |
      <a href="https://github.com/libLAS/libLAS/issues/" title="Bugs">github</a> |
      <a href="../../faq.html" title="FAQ">FAQ</a> |
      <a href="../../download.html" title="Download">Download</a>
    </td>
  </tr>
  <tr>
    <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">

    </td>
  </tr>
</table>


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../wkt.html" title="Georeferencing LAS files with LAS 1.4"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="rfc_1_verticalcs.html" title="libLAS RFC 1: Vertical Coordinate Systems"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../docs.html">Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">RFCs</a> &#187;</li> 
      </ul>
    </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="liblas-rfc-2-spatialreference-overhaul">
<h1><a class="toc-backref" href="#id1">libLAS RFC 2: SpatialReference Overhaul</a><a class="headerlink" href="#liblas-rfc-2-spatialreference-overhaul" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Frank Warmerdam</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body"><a class="reference external" href="mailto:warmerdam&#37;&#52;&#48;pobox&#46;com">warmerdam<span>&#64;</span>pobox<span>&#46;</span>com</a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">11/19/10</td>
</tr>
<tr class="field-even field"><th class="field-name">Status:</th><td class="field-body">Implemented</td>
</tr>
<tr class="field-odd field"><th class="field-name">Version:</th><td class="field-body">libLAS 1.6</td>
</tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#liblas-rfc-2-spatialreference-overhaul" id="id1">libLAS RFC 2: SpatialReference Overhaul</a></li>
</ul>
</div>
<p>This RFC addresses several areas of change to the liblas::SpatialReference
class and associated services.  The objectives are:</p>
<blockquote>
<div><ul class="simple">
<li>Minimize the default exposure of libLAS applications to definitions
from the GeoTIFF library.</li>
<li>Minimize the default exposure of libLAS applications to definitions
from the GDAL library.</li>
<li>Provide a mechanism to capture coordinate system definitions in a LAS
file that cannot be represented via GeoTIFF tags via a liblas
vendor proprietary WKT VLR.</li>
<li>Ensure that the liblas::SpatialReference class can hold such a non
GeoTIFF definition.</li>
</ul>
</div></blockquote>
<div class="section" id="justification-for-minimized-geotiff-gdal-include-flow-through">
<h2>Justification for Minimized GeoTIFF / GDAL Include Flow Through<a class="headerlink" href="#justification-for-minimized-geotiff-gdal-include-flow-through" title="Permalink to this headline">¶</a></h2>
<p>Currently the lasspatialreference.hpp and a few other include files
pull in libgeotiff, and GDAL include files somewhat gratuitously if
these sublibraries are enabled in the build.</p>
<p>This introduces a lot of cruft into the global namespace.  Also due to the
“C” style includes of these sublibraries, it introduces a lot of junk that
might interfere in surprising ways and in contrast to how the rest of
libLAS in very careful to put things into namespaces and otherwise be
somewhat sparing of includes.</p>
<p>The cleanup should help avoid conflicts and namespace pollution for
applications primarily linking against libLAS and not wanting to use
libgeotiff or GDAL services directly.  It should also make building somewhat
less fragile in some cases.</p>
</div>
<div class="section" id="justification-for-wkt-coordinate-system-representation">
<h2>Justification for WKT Coordinate System Representation<a class="headerlink" href="#justification-for-wkt-coordinate-system-representation" title="Permalink to this headline">¶</a></h2>
<p>There are a significant number of coordinate systems, and options that
cannot be represented in GeoTIFF tags.  This includes TOWGS84 parameters,
options to use particular horizontal and vertical grid shift files, and
support for projection methods that don’t have CT_ definitions for
GeoTIFF.</p>
<p>Currently the liblas::SpatialReference class converts passed in WKT
coordinate system definitions into a GeoTIFF VLR and future requests for
the WKT are created by converting the GeoTIFF VLR back into WKT.  This
makes it essentially impossible currently for <a class="reference internal" href="../../utilities/las2las.html#las2las"><span class="std std-ref">las2las</span></a> to perform
transformations between coordinate systems not representable in GeoTIFF
terms even if the source and destination are provided on the command-line in
WKT format.</p>
<p>Also, it seems with future versions of LAS format some variation of OGC
WKT in a VLR will become a supported, or even the preferred way of
representing coordinate systems.</p>
<p>Given these points it seems reasonable to make liblas::SpatialReference
less GeoTIFF VLR oriented now.</p>
</div>
<div class="section" id="include-file-overhaul">
<h2>Include File Overhaul<a class="headerlink" href="#include-file-overhaul" title="Permalink to this headline">¶</a></h2>
<p>The basic plan is to remove includes of all GeoTIFF include files from
any public liblas include files.  For objects, like liblas::SpatialReference,
that depend on GeoTIFF definitions like GTIF, ST_TIFF or GTIFDefn we will
substitute dummy types if the corresponding GeoTIFF include files have
not already been included in advance by the application.  This looks something
like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Fake</span> <span class="n">out</span> <span class="n">the</span> <span class="n">compiler</span> <span class="k">if</span> <span class="n">we</span> <span class="n">don</span><span class="s1">&#39;t have libgeotiff includes already</span>
<span class="c1">#if !defined(__geotiff_h_)</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="n">GTIFS</span> <span class="o">*</span><span class="n">GTIF</span><span class="p">;</span>
<span class="c1">#endif</span>
<span class="c1">#if !defined(__geo_simpletags_h_)</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="n">ST_TIFFS</span> <span class="o">*</span><span class="n">ST_TIFF</span><span class="p">;</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<p>Thus libLAS library code, and application code that wants “proper”
GTIF and ST_TIFF types will need to include the corresponding libgeotiff
include files <em>before</em> including lasspatialreference.hpp.  Any attempt to
include these libgeotiff include files <em>after</em> including lasspatialreference.hpp
will cause conflicts.  Yes, this is somewhat unfortunate and will be an
unobvious requirement to new folks.  Some existing application code will
likely need a bit of include reordering before it will work.</p>
<p>It is intended that similar approach might be used for GDAL and OGR
dependencies.  The primary place where this is a concern seems to be
lastransform.hpp.</p>
<p>It is also planned to move the lasversion.hpp function implementations into a
.cpp file to avoid having to include libgeotiff and GDAL include files right
in lasversion.hpp.  This should have the added benefit of not making what
lasversion.hpp returns depend on what extra macros (like <cite>HAVE_GDAL</cite>) are defined
when it is included vs. when libLAS itself is compiled and linked.</p>
</div>
<div class="section" id="spatialreference-wkt-updates">
<h2>SpatialReference WKT Updates<a class="headerlink" href="#spatialreference-wkt-updates" title="Permalink to this headline">¶</a></h2>
<p>Additions to SpatialReference Class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span>
  <span class="n">enum</span> <span class="n">GeoVLRType</span>
  <span class="p">{</span>
      <span class="n">eGeoTIFF</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
      <span class="n">eOGRWKT</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="p">};</span>

  <span class="n">void</span> <span class="n">ClearVLRs</span><span class="p">(</span> <span class="n">GeoVLRType</span> <span class="n">eType</span> <span class="p">);</span>

<span class="n">private</span><span class="p">:</span>
  <span class="n">std</span><span class="p">::</span><span class="n">string</span> <span class="n">m_wkt</span><span class="p">;</span>
</pre></div>
</div>
<p>The GeoVLRType enumeration is currently used just to define what information
should be wiped in a call to ClearVLRs() but in the future it might also
be used for other purposes.</p>
<p>The ClearVLRs() method clears either the WKT VLR + m_vlr, or the GeoTIFF
VLRs and the associated m_gtiff, m_tiff objects.</p>
<p>The m_wkt is used internally to cache the current WKT string associated
with the spatial reference.</p>
<p>The SpatialReference class is updated to:</p>
<blockquote>
<div><ul class="simple">
<li>Generated both GeoTIFF and WKT VLRs in the ResetVLRs() method.</li>
<li>GetWKT() now just returns the WKT definition if it is available, otherwise
it computes the WKT from the GeoTIFF definition.</li>
<li>SetWKT() now caches the WKT as well as creating the GeoTIFF definition
from it.  Then the WKT and GeoTIFF VLRs are generated.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>A liblas::SpatialReference instance that was read/generated from VLRs containing
only GeoTIFF keys will continue to only have GeoTIFF keys until you
issue a call to SetWKT().  You can simply do the following to WKT-enable
a liblas::SpatialReference in that case:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reference</span><span class="o">.</span><span class="n">SetWKT</span><span class="p">(</span><span class="n">reference</span><span class="o">.</span><span class="n">GetWKT</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you want <em>only</em> GeoTIFF VLRs you should normally generate the
SpatialReference and then call “ClearVLRs(eOGRWKT);” before setting the
SpatialReference on the header being written. If you want <em>only</em> a WKT VLR
then you should call “ClearVLRs(eGeotIFF);” at the same point.</p>
</div>
</div>
<div class="section" id="wkt-vlr">
<h2>WKT VLR<a class="headerlink" href="#wkt-vlr" title="Permalink to this headline">¶</a></h2>
<p>Currently the OGR WKT VLR is currently being written with a UserId of
“liblas” and with a RecordId of 2112 to
distinguish it from the GeoTIFF VLRs.</p>
<p>The data is the OGR WKT string with a terminating zero byte. An exception
is thrown if the size of the WKT is larger than a VLR record can hold.</p>
<p>Is there any scheme to assign RecordIds?  Perhaps we should pick a value
outside the normal legal range for TIFF tags?  Or perhaps we should be
using a different UserId?</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is anticipated at some point in the future there will be a
WKT VLR definition as part of the LAS specification and that it’s contents
may be more accurately defined as OGC WKT rather than OGR WKT which can
contain a variety of extensions to the specification.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../docs.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start.html">Getting Started with libLAS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../osgeo4w.html">Windows Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../compilation.html">Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">FAQ</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Development</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#topics">Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#authors">Authors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../utilities/index.html">LAS Utility Applications</a></li>
<li class="toctree-l1"><a class="reference external" href="http://liblas.org/doxygen/annotated.html">C++ Class API</a></li>
<li class="toctree-l1"><a class="reference external" href="http://liblas.org/doxygen/liblas_8h.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lastools.html">libLAS’ Relationship to LAStools</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/development/rfc/rfc_2_spatialreference.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../wkt.html" title="Georeferencing LAS files with LAS 1.4"
             >next</a> |</li>
        <li class="right" >
          <a href="rfc_1_verticalcs.html" title="libLAS RFC 1: Vertical Coordinate Systems"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../docs.html">Documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Development</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >RFCs</a> &#187;</li> 
      </ul>
    </div>
<div class="footer">
        &copy; <a href="../../copyright.html">Copyright</a> 2018, Howard Butler, Mateusz Loskot and others.
      Website was last updated on May 03, 2018 
      and created with <a href="http://sphinx.pocoo.org/">Sphinx</a>.


</div>


  </body>
</html>